<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picture Grid Upload</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-color: #fff;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .icons {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 600px;
            margin: 20px 0;
        }
        .icons div {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 24px;
            height: 24px;
            cursor: pointer;
            object-fit: contain;
        }
        .icons img {
            width: 100%;
            height: 100%;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(3, 150px);
            grid-template-rows: repeat(5, 150px);
            gap: 4px;
        }
        .upload-box {
            width: 150px;
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            background-color: #ddd;
            position: relative;
        }
        .upload-box input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .upload-box-img {
            width: 100%; /* Ensure the image fills the upload-box */
            height: 100%; /* Ensure the image fills the upload-box */
            object-fit: cover;  /* Ensure the entire image is visible within the box */
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%); /* Adjust for centering */
            cursor: grab;
        }

        .upload-icon {
            width: 24px;
            height: 24px;
        }
        .delete-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 20px;
            color: #fff;
            cursor: pointer;
            display: none; /* Hidden by default */
        }
        .upload-box:hover .delete-icon {
            display: block; /* Show delete icon on hover */
        }
    </style>
</head>
<body>
    <div class="icons">
        <div id="grid-icon"><img src="icons/instagram-grid.svg" alt="Grid Icon"></div>
        <div id="reels-icon"><img src="icons/instagram-reels.svg" alt="Reels Icon"></div>
        <div id="tags-icon"><img src="icons/instagram-tag.svg" alt="Tags Icon"></div>
    </div>
    <div class="container">
        <!-- Repeat the upload-box div 15 times -->
        <div class="upload-box" id="upload-box-0">
            <input type="file" accept="image/*" onchange="previewImage(event, 0)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(0)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-1">
            <input type="file" accept="image/*" onchange="previewImage(event, 1)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(1)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-2">
            <input type="file" accept="image/*" onchange="previewImage(event, 2)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(2)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-3">
            <input type="file" accept="image/*" onchange="previewImage(event, 3)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(3)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-4">
            <input type="file" accept="image/*" onchange="previewImage(event, 4)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(4)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-5">
            <input type="file" accept="image/*" onchange="previewImage(event, 5)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(5)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-6">
            <input type="file" accept="image/*" onchange="previewImage(event, 6)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(6)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-7">
            <input type="file" accept="image/*" onchange="previewImage(event, 7)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(7)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-8">
            <input type="file" accept="image/*" onchange="previewImage(event, 8)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(8)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-9">
            <input type="file" accept="image/*" onchange="previewImage(event, 9)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(9)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-10">
            <input type="file" accept="image/*" onchange="previewImage(event, 10)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(10)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-11">
            <input type="file" accept="image/*" onchange="previewImage(event, 11)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(11)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-12">
            <input type="file" accept="image/*" onchange="previewImage(event, 12)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(12)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-13">
            <input type="file" accept="image/*" onchange="previewImage(event, 13)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(13)">✕</span>
        </div>
        <div class="upload-box" id="upload-box-14">
            <input type="file" accept="image/*" onchange="previewImage(event, 14)">
            <img src="icons/instagram-picture.svg" class="upload-icon" alt="Upload Icon">
            <img src="#" alt="Image Preview" class="upload-box-img" style="display:none;">
            <span class="delete-icon" onclick="deleteImage(14)">✕</span>
        </div>
    </div>

    <script>
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
    
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
    
        document.addEventListener('DOMContentLoaded', (event) => {
            let noteId = getQueryParam('noteId');
            if (!noteId) {
                noteId = generateUUID();
                const newUrl = `${window.location.pathname}?noteId=${noteId}`;
                window.history.replaceState({}, '', newUrl);
            }
            const storageKey = `instagramGrid_${noteId}`;
            loadImages(storageKey);
        });
    
        function saveImage(storageKey, index, dataUrl) {
            const storageData = JSON.parse(localStorage.getItem(storageKey)) || {};
            storageData[`image${index}`] = dataUrl;
            localStorage.setItem(storageKey, JSON.stringify(storageData));
        }
    
        function savePosition(storageKey, index, left, top) {
            const storageData = JSON.parse(localStorage.getItem(storageKey)) || {};
            storageData[`position${index}`] = { left, top };
            localStorage.setItem(storageKey, JSON.stringify(storageData));
        }
    
        function loadImages(storageKey) {
            const storageData = JSON.parse(localStorage.getItem(storageKey)) || {};
            Object.keys(storageData).forEach(key => {
                const index = key.replace(/(image|position)/, '');
                const imgElement = document.querySelector(`#upload-box-${index} .upload-box-img`);
                const iconElement = document.querySelector(`#upload-box-${index} .upload-icon`);
                
                if (key.startsWith('image')) {
                    imgElement.src = storageData[key];
                    imgElement.style.display = 'block';
                    iconElement.style.display = 'none';
                    makeImageMovable(imgElement, storageKey, index);
                } else if (key.startsWith('position')) {
                    const { left, top } = storageData[key];
                    imgElement.style.left = left;
                    imgElement.style.top = top;
                }
            });
        }
    
        function previewImage(event, index) {
            const input = event.target;
            const file = input.files[0];
            const reader = new FileReader();
    
            reader.onload = function(e) {
                const imgElement = input.nextElementSibling.nextElementSibling;
                const iconElement = input.nextElementSibling;
                imgElement.src = e.target.result;
                imgElement.style.display = 'block';
                iconElement.style.display = 'none';
    
                let noteId = getQueryParam('noteId');
                const storageKey = `instagramGrid_${noteId}`;
                saveImage(storageKey, index, e.target.result);
                makeImageMovable(imgElement, storageKey, index);
            }
    
            reader.readAsDataURL(file);
        }
    
        function makeImageMovable(imgElement, storageKey, index) {
            let isDragging = false;
            let startX, startY, startLeft, startTop;
    
            // Load position from localStorage
            const positionData = JSON.parse(localStorage.getItem(storageKey)) || {};
            if (positionData[`position${index}`]) {
                const { left, top } = positionData[`position${index}`];
                imgElement.style.left = left;
                imgElement.style.top = top;
            }
    
            imgElement.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
    
            function startDrag(e) {
                e.preventDefault();
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startLeft = imgElement.offsetLeft;
                startTop = imgElement.offsetTop;
                imgElement.style.transition = 'none'; // Disable transition during drag
                imgElement.style.cursor = 'grabbing'; // Change cursor to grabbing
            }
    
            function drag(e) {
                if (!isDragging) return;
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                imgElement.style.left = `${startLeft + deltaX}px`;
                imgElement.style.top = `${startTop + deltaY}px`;
            }
    
            function endDrag() {
                if (isDragging) {
                    isDragging = false;
                    imgElement.style.transition = 'left 0.2s ease-out, top 0.2s ease-out'; // Re-enable transition
                    imgElement.style.cursor = 'grab'; // Change cursor back to grab
    
                    // Save position to localStorage
                    savePosition(storageKey, index, imgElement.style.left, imgElement.style.top);
                }
            }
        }
    
        function deleteImage(index) {
            let noteId = getQueryParam('noteId');
            const storageKey = `instagramGrid_${noteId}`;
            const storageData = JSON.parse(localStorage.getItem(storageKey)) || {};
    
            delete storageData[`image${index}`];
            delete storageData[`position${index}`];
            localStorage.setItem(storageKey, JSON.stringify(storageData));
    
            const uploadBox = document.querySelector(`#upload-box-${index}`);
            const imgElement = uploadBox.querySelector('.upload-box-img');
            const iconElement = uploadBox.querySelector('.upload-icon');
            imgElement.src = '';
            imgElement.style.display = 'none';
            iconElement.style.display = 'block';
            imgElement.style.left = '';
            imgElement.style.top = '';
        }
    </script>
    
</body>
</html>
